<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Biblioteca Online</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        header {
            background: #6200ea;
            color: white;
            padding: 20px;
            text-align: center;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        header h1 {
            margin: 0;
        }
        header nav a {
            color: white;
            text-decoration: none;
            margin-left: 20px;
        }
        .search-bar {
            text-align: center;
            margin: 20px;
        }
        input[type="text"] {
            width: 60%;
            padding: 10px;
            font-size: 16px;
        }
        button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            background-color: #6200ea;
            color: white;
            border: none;
            border-radius: 4px;
        }
        .book-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding: 20px;
        }
        .book-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px;
            padding: 15px;
            width: 250px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        .book-card img {
            width: 100%;
            height: auto;
            border-radius: 5px;
        }
        .favorite-btn {
            background-color: #ff4081;
            color: white;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
        }
        .review-box {
            margin-top: 10px;
        }
        textarea {
            width: 100%;
            height: 60px;
        }
        .submit-review {
            margin-top: 5px;
            background-color: #03a9f4;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
        }
        .favorite-page {
            padding: 20px;
            text-align: center;
        }
        .favorite-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding: 20px;
        }

    </style>
</head>
<body>

<header>
    <h1>üìö Biblioteca Online</h1>
    <nav>
        <a href="perfil.html">Meu Perfil</a>
    </nav>
    <p>Pesquise, Favorite e Escreva Resenhas</p>
</header>

<div class="search-bar">
    <input type="text" id="searchInput" placeholder="Digite o nome do livro..." />
    <button onclick="searchBooks()">Buscar</button>
</div>

<div class="book-list" id="bookList">
    </div>

<script>
    // Inicializa um Set para armazenar os IDs dos livros favoritos, recuperando-os do localStorage se existirem.
    let favorites = new Set(JSON.parse(localStorage.getItem('favorites')) || []);
    // Inicializa um objeto para armazenar as resenhas dos livros, recuperando-as do localStorage se existirem.
    const reviews = JSON.parse(localStorage.getItem('reviews')) || {};

    // Fun√ß√£o ass√≠ncrona para buscar livros na API do Google Books com base na pesquisa do usu√°rio.
    async function searchBooks() {
        const query = document.getElementById("searchInput").value;
        // Se a pesquisa estiver vazia, n√£o faz nada.
        if (!query) return;

        // Faz uma requisi√ß√£o para a API do Google Books com o termo de pesquisa codificado na URL.
        const response = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}`);
        // Converte a resposta da API para formato JSON.
        const data = await response.json();

        // Se a API n√£o retornar nenhum item, exibe uma mensagem informando.
        if (!data.items) {
            document.getElementById("bookList").innerHTML = "<p>Nenhum resultado encontrado.</p>";
            return;
        }

        // Chama a fun√ß√£o para renderizar os livros encontrados na tela.
        renderBooks(data.items);
    }

    // Fun√ß√£o para renderizar a lista de livros na interface do usu√°rio.
    function renderBooks(books) {
        const list = document.getElementById("bookList");
        // Limpa qualquer conte√∫do anterior na lista de livros.
        list.innerHTML = "";

        // Itera sobre cada livro na lista de livros recebida.
        books.forEach(bookItem => {
            const info = bookItem.volumeInfo;
            const bookId = bookItem.id;
            // Obt√©m o t√≠tulo do livro ou define como "Sem t√≠tulo" se n√£o houver.
            const title = info.title || "Sem t√≠tulo";
            // Obt√©m os autores do livro ou define como "Autor desconhecido" se n√£o houver.
            const authors = info.authors ? info.authors.join(", ") : "Autor desconhecido";
            // Obt√©m o link da miniatura da capa do livro ou usa um placeholder se n√£o houver.
            const thumbnail = info.imageLinks ? info.imageLinks.thumbnail : "https://via.placeholder.com/128x200?text=Sem+Capa";

            // Cria um novo elemento div para representar o card do livro.
            const card = document.createElement("div");
            card.className = "book-card";
            // Define o conte√∫do HTML do card do livro, incluindo imagem, t√≠tulo, autor, bot√£o de favorito e √°rea de resenha.
            card.innerHTML = `
                <img src="${thumbnail}" alt="Capa do livro ${title}" />
                <h3>${title}</h3>
                <p><strong>Autor:</strong> ${authors}</p>
                <button class="favorite-btn" onclick="toggleFavorite('${bookId}')">
                    ${favorites.has(bookId) ? "‚òÖ Favoritado" : "‚òÜ Favoritar"}
                </button>
                <div class="review-box">
                    <textarea id="review-${bookId}" placeholder="Escreva sua resenha...">${reviews[bookId] || ""}</textarea>
                    <button class="submit-review" onclick="submitReview('${bookId}')">Salvar Resenha</button>
                </div>
            `;
            // Adiciona o card do livro √† lista de livros na p√°gina.
            list.appendChild(card);
        });
    }

    // Fun√ß√£o para adicionar ou remover um livro da lista de favoritos.
    function toggleFavorite(id) {
        // Verifica se o livro j√° est√° nos favoritos.
        if (favorites.has(id)) {
            // Se estiver, remove o ID do Set de favoritos.
            favorites.delete(id);
        } else {
            // Se n√£o estiver, adiciona o ID ao Set de favoritos.
            favorites.add(id);
        }
        // Atualiza o localStorage com a nova lista de IDs favoritos.
        localStorage.setItem('favorites', JSON.stringify(Array.from(favorites)));
        // Re-renderiza os bot√µes de favorito sem fazer uma nova busca na API.
        const bookCards = document.querySelectorAll('.book-card');
        bookCards.forEach(card => {
            // Encontra o ID do livro associado ao card.
            const bookId = card.querySelector('.review-box textarea')?.id.split('-')[1];
            // Se o ID do card corresponder ao ID do livro que foi favoritado/desfavoritado.
            if (bookId === id) {
                const favButton = card.querySelector('.favorite-btn');
                // Atualiza o texto do bot√£o de favorito com base no estado atual nos favoritos.
                favButton.textContent = favorites.has(id) ? "‚òÖ Favoritado" : "‚òÜ Favoritar";
            }
        });
    }

    // Fun√ß√£o para salvar a resenha de um livro no localStorage.
    function submitReview(id) {
        // Obt√©m a refer√™ncia da textarea da resenha para o livro espec√≠fico.
        const textarea = document.getElementById(`review-${id}`);
        // Armazena o valor da resenha no objeto de resenhas usando o ID do livro como chave.
        reviews[id] = textarea.value;
        // Salva o objeto de resenhas atualizado no localStorage.
        localStorage.setItem('reviews', JSON.stringify(reviews));
        // Exibe um alerta para informar ao usu√°rio que a resenha foi salva.
        alert("Resenha salva!");
    }
</script>

</body>
</html>